pkgname=('ranger-git')
srcname='ranger'
pkgver='r1'
pkgrel='1'
pkgdesc='A simple, vim-like file manager'
arch=('any')
url='https://github.com/hut/ranger'
license=('GPL3')

depends=('python')
optdepends=(
    'file: for determining file types'
    'python-chardet: in case of encoding detection problems'
    'sudo: to use the "run as root"-feature'
    'libcaca: for ASCII-art image previews'
    'highlight: for syntax highlighting of code'
    'atool: for previews of archives'
    'w3m: for previews of images and html pages'
    'lynx: for previews of html pages'
    'elinks: for previews of html pages'
    'poppler: for pdf previews'
    'transmission-cli: for viewing bittorrent information'
    'mediainfo: for viewing information about media files'
    'perl-image-exiftool: for viewing information about media files'
)
makedepends=('git')
provides=('ranger')
conflicts=('ranger')

source=(
    "${srcname}::git+https://github.com/nfnty/ranger.git"
    'mime.patch'
)
sha256sums=(
    'SKIP'
    'SKIP'
)

pkgver() {
    cd "${srcdir}/${srcname}"

    printf 'r%s.%s\n' \
        "$( git rev-list HEAD | wc --lines )" \
        "$( git describe --always | sed 's/-/./g' )"
}

prepare() {
    cd "${srcdir}/${srcname}"

    git cherry-pick --no-commit d4384b6cd04cbbd5f096eb2b3b61674b11bd6b1c

    git apply "${srcdir}/mime.patch"
}

package() {
    cd "${srcdir}/${srcname}"

    python setup.py -q install --root="${pkgdir}" --optimize=1
}
